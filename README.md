# ü§ñ Telegram Health Coach Bot aka giga-perceptron-bot 

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞, –≤—ã—Å—Ç—É–ø–∞—é—â–µ–≥–æ –≤ —Ä–æ–ª–∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∫–æ—É—á–∞ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å –∫ —É–ª—É—á—à–µ–Ω–∏—é —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —Ñ–æ–∫—É—Å–∏—Ä—É—è—Å—å –Ω–∞ –æ–¥–Ω–æ–π –∏–∑ —Ü–µ–ª–µ–π (–≤ MVP —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ü–µ–ª—å **–ø–æ—Ö—É–¥–µ–Ω–∏–µ**).

–ë–æ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥, —Å–æ–±–∏—Ä–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏), –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–∏–º—É–ª—è—Ü–∏—é –¥–Ω–µ–π –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å. –¢–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç—ã, —Å–æ–≤–µ—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* üß† –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –ø–æ–º–æ—â—å—é LLM)
* üìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* üìÜ –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ 7-–¥–Ω–µ–≤–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å –∞–Ω–∞–ª–∏–∑–æ–º
* üìä –ü–æ–¥—Å—á–µ—Ç –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
* üìù –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã –æ—Ç LLM
* üí¨ –†–µ–∂–∏–º –¥–∏–∞–ª–æ–≥–∞ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
[User] ‚Üî [Telegram Bot] ‚Üî [FSM + State Machine] ‚Üî [LLM Engine] ‚Üî [OpenAI | GigaChat]
                                 |
                                 ‚Üì
                        [Health Simulation Core]
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Telegram Bot** ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ inline-–∫–Ω–æ–ø–∫–∏ —Å –ø–æ–º–æ—â—å—é `pyTelegramBotAPI`.
2. **FSM –∏ User State** ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–∫–ª—é—á–∞—è —ç—Ç–∞–ø—ã: –≤—ã–±–æ—Ä —Ü–µ–ª–∏, —Å–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Å–∏–º—É–ª—è—Ü–∏—è, —á–∞—Ç –∏ —Ç.–¥.
3. **LLM-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LangChain –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥–µ–ª–µ–π –æ—Ç OpenAI –∏ GigaChat.
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** ‚Äî —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø–æ –¥–Ω—è–º —Å —É—á–µ—Ç–æ–º –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö/—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
5. **–û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑** ‚Äî –±–æ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫–∏–µ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
6. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** ‚Äî –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–π –ø–æ–ª–æ—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å –±–∞–ª–ª–∞–º–∏.

---

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### 1. –°—Ç–∞—Ä—Ç

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/start`. –ë–æ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ü–µ–ª—å ‚Äî —Ç–µ–∫—Å—Ç–æ–º –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫.

### 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–∏

LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ü–µ–ª—å –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –µ—ë (–Ω–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ "–ø–æ—Ö—É–¥–µ—Ç—å").

### 3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

* –ú–æ–≥—É—Ç –±—ã—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
* –ò–ª–∏ –≤–≤–µ–¥–µ–Ω—ã –≤—Ä—É—á–Ω—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### 4. –°–∏–º—É–ª—è—Ü–∏—è 7 –¥–Ω–µ–π

–ù–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è 7 –¥–Ω–µ–π –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Å–æ–Ω, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ø–∏—Ç–∞–Ω–∏–µ –∏ –¥—Ä.), –∫–∞–∂–¥–æ–º—É –¥–Ω—é –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —Å–∫–æ—Ä (0..5). –°—É–º–º–∞—Ä–Ω—ã–π –±–∞–ª–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å.

### 5. –û—Ç—á–µ—Ç –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è

LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –æ—Ç—á–µ—Ç —Å —Å–æ–≤–µ—Ç–∞–º–∏. –ü–æ—Å–ª–µ 7 –¥–Ω–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–æ 14 –¥–Ω–µ–π.

### 6. –†–µ–∂–∏–º —á–∞—Ç–∞

–í –ª—é–±–æ–µ –≤—Ä–µ–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç-—Ä–µ–∂–∏–º –∏ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∑–¥–æ—Ä–æ–≤—å—é, –ø–∏—Ç–∞–Ω–∏—é, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

---


## –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –ö–ª–∞—Å—Å UserHealthState

–≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–°–æ—Å—Ç–æ–∏—Ç –∏–∑:**

* `user_id` ‚Äî Telegram user ID.
* `dialog_history` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (—Å —Ç–µ–≥–∞–º–∏ üë§/ü§ñ).
* `interaction_state` ‚Äî FSM-—Å–æ—Å—Ç–æ—è–Ω–∏–µ ("goal", "collect\_data", "daily\_update" –∏ —Ç.–¥.).
* `health_goal` ‚Äî —Ü–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
* `input_answers` ‚Äî –∞–Ω–∫–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–ª, —Ä–æ—Å—Ç –∏ —Ç.–¥.).
* `history_data` ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è –¥–Ω–µ–π (7+).
* `current_day`, `total_score` ‚Äî —Å—á–µ—Ç—á–∏–∫–∏ –¥–Ω–µ–π –∏ –±–∞–ª–ª–æ–≤.
* `_memory_context` ‚Äî —Å–∂–∞—Ç—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM

**–ú–µ—Ç–æ–¥—ã:**

* `add_message`, `reset_dialog`, `get_context`, `update_memory` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –∏—Å—Ç–æ—Ä–∏–µ–π.
* `generate_default_params()` ‚Äî —Å–ª—É—á–∞–π–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

### –§—É–Ω–∫—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

* `get_user()` ‚Äî –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π `UserHealthState`, –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π.
* `random_day_params()` ‚Äî —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –æ–¥–∏–Ω –¥–µ–Ω—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∫–µ—Ç—ã.
* `params_to_score()` ‚Äî –≤—ã—á–∏—Å–ª—è–µ—Ç —Å–∫–æ—Ä –æ—Ç 0 –¥–æ 5.
* `make_7days_history()` ‚Äî —Å–æ–∑–¥–∞—ë—Ç 7-–¥–Ω–µ–≤—É—é —Å–∏–º—É–ª—è—Ü–∏—é.
* `call_llm()` ‚Äî –æ–±–æ–ª–æ—á–∫–∞ –¥–ª—è –≤—ã–∑–æ–≤–∞ LLM —Å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
* `detect_user_intent()` ‚Äî –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Ü–µ–ª—å (–ø–æ—Ö—É–¥–µ–Ω–∏–µ/—Å–æ–Ω/...)

--- 

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
TELEGRAM_BOT_TOKEN=your_telegram_token
OPENAI_API_KEY=your_openai_key
GIGA_CHAT_API_KEY=your_gigachat_key
MODEL_PROVIDER=openai  # –∏–ª–∏ gigachat
MODEL=gpt-3.5-turbo     # –∏–ª–∏ GigaChat: GigaChat-Pro
```

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python bot.py
```

---

## –û—Ü–µ–Ω–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è (Score)

–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –º–æ–¥–µ–ª–∏—Ä—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

* —Å–æ–Ω
* –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
* –ø–∏—Ç–∞–Ω–∏–µ
* –º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
* –Ω–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–µ
* —Å–ø–æ—Ä—Ç / –º–µ–¥–∏—Ç–∞—Ü–∏—è / —á—Ç–µ–Ω–∏–µ / –ª–µ–∫–∞—Ä—Å—Ç–≤–∞

–ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è:

* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–æ—Ç–ª–∏—á–Ω–æ/—Ö–æ—Ä–æ—à–æ/—É–¥–æ–≤–ª./–ø–ª–æ—Ö–æ) ‚Äî 0.1 –¥–æ 1.0
* –î–∞/–Ω–µ—Ç (–º–µ–¥–∏—Ç–∞—Ü–∏—è, —Å–ø–æ—Ä—Ç –∏ —Ç.–¥.) ‚Äî +0.25
* –ú–∞–∫—Å–∏–º—É–º –≤ –¥–µ–Ω—å: 5 –±–∞–ª–ª–æ–≤
* –ó–∞ 7 –¥–Ω–µ–π ‚Äî –º–∞–∫—Å–∏–º—É–º 35 (–≤ –¥–µ–º–æ –ø–æ—Ä–æ–≥ 25)

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **Python 3.10+**
* **telebot (pyTelegramBotAPI)** ‚Äî Telegram-–±–æ—Ç
* **langchain, openai, gigachat** ‚Äî LLM-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
* **dotenv** ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
* **logging** ‚Äî –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

---

